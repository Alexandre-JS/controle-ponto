<app-header
  title="Registro de Presença"
  icon="calendar-outline"
  [showMenu]="true"
  [showThemeToggle]="true"
  [showNotifications]="false">
</app-header>

<ion-content class="ion-padding">
  <ion-list *ngIf="employees.length > 0; else noEmployees" class="form-list">
    <form [formGroup]="attendanceForm" (ngSubmit)="onSubmit()">
      <ion-list>
        <ion-item class="form-item">
          <ion-label position="floating">Funcionário</ion-label>
          <ion-select formControlName="employeeId">
            <ion-select-option *ngFor="let employee of employees" [value]="employee.id">
              {{ employee.name }}
            </ion-select-option>
          </ion-select>
        </ion-item>

        <ion-item class="form-item">
          <ion-label position="floating">Data</ion-label>
          <ion-datetime
            formControlName="date"
            display-format="DD/MM/YYYY"
            [min]="'2023'"
            [max]="'2025'">
          </ion-datetime>
        </ion-item>

        <ion-item class="form-item">
          <ion-label position="floating">Horário</ion-label>
          <ion-datetime
            formControlName="check_in"
            display-format="HH:mm"
            picker-format="HH:mm">
          </ion-datetime>
        </ion-item>

        <ion-item class="form-item">
          <ion-label position="floating">Status</ion-label>
          <ion-select formControlName="status">
            <ion-select-option value="Presente">Presente</ion-select-option>
            <ion-select-option value="Ausente">Ausente</ion-select-option>
          </ion-select>
        </ion-item>

        <ion-item class="form-item">
          <ion-label position="floating">Observações</ion-label>
          <ion-textarea formControlName="observations" rows="3"></ion-textarea>
        </ion-item>
      </ion-list>

      <ion-button expand="block" type="submit" [disabled]="!attendanceForm.valid || isLoading" class="app-button">
        <ion-icon name="checkmark-circle-outline" slot="start"></ion-icon>
        Registrar Presença
      </ion-button>
    </form>

    <ion-list class="ion-margin-top records-list">
      <ion-list-header>
        <ion-label class="text-heading">Registros de Hoje</ion-label>
      </ion-list-header>

      <ion-item *ngFor="let record of todayAttendance" class="record-item">
        <ion-label>
          <h2>{{ getEmployeeName(record.employee_id) }}</h2>
          <p>Entrada: {{ record.check_in }}</p>
          <p *ngIf="record.check_out">Saída: {{ record.check_out }}</p>
          <p *ngIf="record.late_minutes && record.late_minutes > 0">
            Atraso: {{ record.late_minutes }} minutos
          </p>
          <p *ngIf="record.observations">Obs: {{ record.observations }}</p>
        </ion-label>
        <ion-badge [color]="record.status === 'Presente' ? 'success' :
                           record.status === 'Atrasado' ? 'warning' :
                           record.status === 'Em exercício' ? 'primary' :
                           record.status === 'Saída' ? 'tertiary' :
                           record.status === 'Justificado' ? 'secondary' : 'danger'">
          {{ record.status }}
        </ion-badge>
      </ion-item>

      <ion-item *ngIf="todayAttendance.length === 0" class="empty-state">
        <ion-label color="medium" class="ion-text-center text-body">
          Nenhum registro para hoje
        </ion-label>
      </ion-item>
    </ion-list>
  </ion-list>

  <ng-template #noEmployees>
    <div class="ion-text-center ion-padding empty-state-container">
      <ion-icon name="people-outline" size="large" color="medium"></ion-icon>
      <p class="text-body">Nenhum funcionário cadastrado</p>
      <ion-button routerLink="/employee" expand="block" color="primary" class="app-button">
        <ion-icon name="add-outline" slot="start"></ion-icon>
        Cadastrar Funcionários
      </ion-button>
    </div>
  </ng-template>

  <ion-loading [isOpen]="isLoading" message="Carregando..."></ion-loading>
</ion-content>
